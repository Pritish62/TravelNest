<% layout('/layouts/boilerplate') -%>   
<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
/>

    <main class="min-h-[calc(100vh-4rem)] flex items-center">

        <div
            class=" max-w-4xl mx-auto my-12 rounded-md bg-neutral-primary-soft p-8 border rounded-base shadow-2xl flex flex-col md:flex-row items-start gap-6 lg:h-[60vh]">

            <img class="object-cover  rounded-md w-full md:w-64 lg:w-72 h-64 lg:h-full flex-shrink-0 rounded-base"
                src="<%= listing.image.url %>" alt="<%= listing.title %>">
            <div class="flex-1 h-full flex flex-col justify-between md:p-6 leading-normal text-left">

                <h3 class="mb-2 text-2xl font-bold tracking-tight text-heading">
                    <%= listing.title %>
                </h3>
                <p class="mb-6 text-body max-w-xl">
                    <%= listing.location %> , <%= listing.country %>
                </p>
                <p class="mb-6 text-body max-w-xl">
                    listed by-<i><%= listing.owner.username%></i>
                </p>
                <p class="mb-6 text-body max-w-xl">
                    <%= listing.description%>
                </p>
                <p class="font-semibold text-slate-800 max-w-xl">&#8377;<%= listing.price.toLocaleString('en-IN') %>
                </p>
                <% if (currUser && listing.owner._id.equals(currUser._id)) { %>
                 <div class="mt-4 flex flex-col sm:flex-row gap-3 items-center sm:items-start">
                     <form action="/listings/<%= listing._id %>/edit" method="get">
                        <button
                            class=" btn-edit w-full sm:w-auto cursor-pointer inline-flex items-center w-auto text-body bg-neutral-secondary-medium box-border border border-default-medium hover:bg-neutral-tertiary-medium hover:text-heading focus:ring-4 focus:ring-neutral-tertiary shadow-xs font-medium leading-5 rounded-base text-sm px-4 py-2.5 focus:outline-none">
                            EDIT
                            <svg class="w-4 h-4 ms-1.5 rtl:rotate-180 -me-0.5" aria-hidden="true"
                                xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none"
                                viewBox="0 0 24 24">
                                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                                    stroke-width="2" d="M19 12H5m14 0-4 4m4-4-4-4" />
                            </svg>
                        </button>
                    </form>
                    <form method="post" action="/listings/<%=listing._id %>?_method=delete">

                        <button
                            class=" btn-danger w-full sm:w-auto cursor-pointer inline-flex items-center w-auto text-body bg-neutral-secondary-medium box-border border border-default-medium hover:bg-neutral-tertiary-medium hover:text-heading focus:ring-4 focus:ring-neutral-tertiary shadow-xs font-medium leading-5 rounded-base text-sm px-4 py-2.5 focus:outline-none">
                            DELETE
                            <svg class="w-4 h-4 ms-1.5 rtl:rotate-180 -me-0.5" aria-hidden="true"
                                xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none"
                                viewBox="0 0 24 24">
                                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                                    stroke-width="2" d="M19 12H5m14 0-4 4m4-4-4-4" />
                            </svg>
                        </button>
                    </form>
                </div>
                <% } %>
            </div>
        </div>
    </main>
    <hr>
    
     <div class="max-w-xl mx-auto ">
        <div class=" h-full  md:p-6 leading-normal text-left">
            <% if (currUser) { %>
            <form action="/listings/<%= listing._id %>/reviews" method="POST">
                <h1>write review</h1>
                <fieldset class="starability-slot">
                    <legend>Rating:</legend>
                    <input type="radio" id="no-rate" class="input-no-rate" name="review[rating]" value="1" checked aria-label="No rating." />
                    <input type="radio" id="first-rate1" name="review[rating]" value="1" />
                    <label for="first-rate1" title="Terrible">1 star</label>
                    <input type="radio" id="first-rate2" name="review[rating]" value="2" />
                    <label for="first-rate2" title="Not good">2 stars</label>
                    <input type="radio" id="first-rate3" name="review[rating]" value="3" />
                    <label for="first-rate3" title="Average">3 stars</label>
                    <input type="radio" id="first-rate4" name="review[rating]" value="4" />
                    <label for="first-rate4" title="Very good">4 stars</label>
                    <input type="radio" id="first-rate5" name="review[rating]" value="5" />
                    <label for="first-rate5" title="Amazing">5 stars</label>
                </fieldset>

                <label for="comment" class="block mb-2.5 text-sm font-medium text-heading">Your message</label>
                <textarea id="comment" rows="4" name="review[comment]"
                    class="bg-neutral-secondary-medium border border-default-medium mb-3 text-heading text-sm rounded-base focus:ring-brand focus:border-brand block w-full p-3.5 shadow-s placeholder:text-body"
                    placeholder="Write your thoughts here..." required></textarea>

                <button
                    class=" btn-edit w-full sm:w-auto cursor-pointer inline-flex items-center w-auto text-body bg-neutral-secondary-medium box-border border border-default-medium hover:bg-neutral-tertiary-medium hover:text-heading focus:ring-4 focus:ring-neutral-tertiary shadow-xs font-medium leading-5 rounded-base text-sm px-4 py-2.5 focus:outline-none">
                    SUBMIT REVIEW
                    <svg class="w-4 h-4 ms-1.5 rtl:rotate-180 -me-0.5" aria-hidden="true"
                        xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M19 12H5m14 0-4 4m4-4-4-4" />
                    </svg>
                </button>
            </form>
            <% } %>
        </div>
    </div>
    <hr>
    <div class="review max-w-3xl mx-auto ">
        <p><b>All Reviews</b></p>
        <div class="review-card  grid grid-cols-2  ">
            <% for(review of listing.reviews){ %>
                <div
                    class="bg-neutral-primary-soft block  ms-3 mr-3 p-3 mb-5 border border-default rounded-base shadow-xs">
                    <h5 class="mb-3 text-2xl font-semibold tracking-tight text-heading leading-8">@<%= review.author.username %></h5>
                    <div>
                        <p class="starability-result" data-rating=<%= review.rating %> >
                         Rated: 3 stars
                    </p>
                    </div>
                    <p class="text-body mb-6">
                        <%= review.comment %> 
                    </p>
                                   <% if (currUser && review.author._id.equals(currUser._id) ) { %>

                     <form method="post" action="/listings/<%= listing._id %>/reviews/<%= review._id %>?_method=DELETE" >
                        <button
                            class="br-gray-300 hover:bg-gray-400 hover:border-white text-sm text-gray-800 font-bold py-1.5 px-3 border border-gray-800  rounded inline-flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="15" height="15"
                                viewBox="0 0 24 24">
                                <path
                                    d="M 10 2 L 9 3 L 3 3 L 3 5 L 4.109375 5 L 5.8925781 20.255859 L 5.8925781 20.263672 C 6.023602 21.250335 6.8803207 22 7.875 22 L 16.123047 22 C 17.117726 22 17.974445 21.250322 18.105469 20.263672 L 18.107422 20.255859 L 19.890625 5 L 21 5 L 21 3 L 15 3 L 14 2 L 10 2 z M 6.125 5 L 17.875 5 L 16.123047 20 L 7.875 20 L 6.125 5 z">
                                </path>
                            </svg>
                            <span>DELETE</span></button>

                    </form>
                    <% } %>
                    
                </div>
                <% } %>
        </div>
    </div>   
    <div id="map" style="height: 400px;">

    </div>
    <script>
  const coordinates =  JSON.stringify(listing.geometry.coordinates) 
</script>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="/js/map.js"></script>